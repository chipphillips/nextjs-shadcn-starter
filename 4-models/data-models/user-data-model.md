# User Data Model

## Overview

This document defines the user data model for the ConstructivAI platform, implemented using Supabase and TypeScript.

## TypeScript Interface

```typescript
interface User {
  // Primary Fields
  id: string;           // Primary key, UUID generated by Supabase
  email: string;        // Unique email address
  name: string | null;  // Optional full name
  role: UserRole;       // User role enum
  
  // Preferences and Settings
  preferences?: {
    notifications: boolean;
    theme: 'light' | 'dark';
    timezone: string;
  };
  
  // Timestamps
  lastLoginAt: Date | null;
  createdAt: Date;      // Automatically managed by Supabase
  updatedAt: Date;      // Automatically managed by Supabase
}

enum UserRole {
  ADMIN = 'admin',
  MANAGER = 'manager',
  MEMBER = 'member'
}
```

## Supabase Schema

```sql
-- Users Table (extends Supabase auth.users)
create table public.user_profiles (
  id uuid references auth.users primary key,
  email text unique not null,
  name text,
  role text not null check (role in ('admin', 'manager', 'member')),
  preferences jsonb,
  last_login_at timestamp with time zone,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Automatically set updated_at timestamp
create trigger set_updated_at
  before update on public.user_profiles
  for each row
  execute procedure moddatetime (updated_at);

-- Enable Row Level Security
alter table public.user_profiles enable row level security;

-- RLS Policies
create policy "Users can view their own profile"
  on public.user_profiles for select
  using (auth.uid() = id);

create policy "Users can update their own profile"
  on public.user_profiles for update
  using (auth.uid() = id);

create policy "Admins can view all profiles"
  on public.user_profiles for select
  using (
    exists (
      select 1 from public.user_profiles
      where id = auth.uid() and role = 'admin'
    )
  );
```

## Relationships

- One-to-Many with Projects (a user can be involved in multiple projects)
- One-to-Many with Tasks (a user can be assigned multiple tasks)
- One-to-Many with Documents (a user can create/own multiple documents)

## Security Considerations

1. **Authentication**:
   - Managed by Supabase Auth
   - Magic link authentication
   - Session management

2. **Authorization**:
   - Role-based access control
   - Row Level Security policies
   - Profile visibility rules

## MVP Scope

### Essential Fields

- âœ… id
- âœ… email
- âœ… name
- âœ… role
- âœ… created_at
- âœ… updated_at

### Future Enhancements

- ðŸ”„ Advanced preferences
- ðŸ”„ Profile picture
- ðŸ”„ Contact information
- ðŸ”„ Skills/certifications
- ðŸ”„ Team associations
